<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8">
  <title>Admin Kasir - Sistem Rumah Sakit</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2.0/dist/css/adminlte.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="hold-transition sidebar-mini">
  <div class="wrapper">

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
        </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link"><i class="fas fa-user-circle"></i> Welcome, admin</a>
        </li>
      </ul>
    </nav>

    <!-- Sidebar -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <a href="#" class="brand-link ml-3">
        <i class="fas fa-hospital mr-1"></i>
        <span class="brand-text font-weight-light">Admin Kasir RS</span>
      </a>
      <div class="sidebar">
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu">
            <li class="nav-item">
              <a href="#" class="nav-link active" id="menu-jasa">
                <i class="fas fa-hand-holding-usd me-2"></i>
                <p>Jasa Layanan</p>
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" id="menu-obat">
                <i class="nav-icon fas fa-pills"></i>
                <p>Lihat Harga Obat</p>
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" id="menu-laporan">
                <i class="nav-icon fas fa-chart-bar"></i>
                <p>Laporan</p>
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" id="menu-user">
                <i class="nav-icon fas fa-users"></i>
                <p>Manajemen User</p>
              </a>
            </li>
          </ul>
          <ul class="nav nav-pills nav-sidebar flex-column mb-3">
            <li class="nav-item">
              <a href="#" class="nav-link text-danger" id="btn-logout">
                <i class="nav-icon fas fa-sign-out-alt"></i>
                <p>Logout</p>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </aside>

    <!-- Content Wrapper -->
    <div class="content-wrapper">

      <!-- Section Jasa Layanan -->
      <section class="content" id="contentJasa">
        <div class="content-header">
          <h1>Kelola Jasa Layanan</h1>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Daftar Layanan</h3>
          </div>
          <div class="card-body">
            <button id="btnTambahLayanan" class="btn btn-success mt-1"><i class="fas fa-plus"></i> Tambah
              Layanan</button>
            <input type="text" id="searchJasa" class="form-control form-control-sm w-auto"
              placeholder="Cari nama layanan...">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>ID Layanan</th>
                  <th>Nama Layanan</th>
                  <th>Harga</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>SRV-001</td>
                  <td>Konsultasi Umum</td>
                  <td>Rp 50.000</td>
                  <td>
                    <button class="btn btn-sm btn-warning btn-edit-layanan"><i class="fas fa-pen"></i> Edit</button>
                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i> Hapus</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Section Harga Obat -->
      <section class="content" id="contentHargaObat" style="display:none;">
        <div class="content-header">
          <h1>Lihat Harga Obat</h1>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Daftar Harga Obat</h3>
          </div>
          <div class="card-body">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>No</th>
                  <th>Nama Obat</th>
                  <th>Harga</th>
                  <th>Stok</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>MED-001</td>
                  <td>Paracetamol</td>
                  <td>Rp 10.000</td>
                  <td>100</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Section Laporan -->
      <section class="content" id="contentLaporan" style="display:none;">
        <div class="content-header">
          <h1>Laporan Keuangan</h1>
        </div>
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
              <h5><i class="fas fa-list-alt me-2"></i>Detail Transaksi</h5>
              <div class="d-flex align-items-center gap-2">
                <label for="filterBulan" class="form-label me-2 mb-0">
                  <i class="fas fa-calendar-alt"></i> Filter Bulan:
                </label>
                <input type="month" id="filterBulan" class="form-control d-inline-block" style="width: 180px;">
                <button id="btnExportExcel" class="btn btn-success" title="Export ke Excel">
                  <i class="fas fa-file-excel"></i> Excel
                </button>
                <button id="btnExportPDF" class="btn btn-danger" title="Export ke PDF">
                  <i class="fas fa-file-pdf"></i> PDF
                </button>
              </div>
            </div>
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>ID Transaksi</th>
                  <th>Tanggal</th>
                  <th>Deskripsi</th>
                  <th>Jumlah (Rp)</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <!-- Contoh data statis, bisa Anda ganti dengan data dinamis -->
                <tr>
                  <td>TRX-001</td>
                  <td>2025-05-10</td>
                  <td>Pembayaran Konsultasi Umum</td>
                  <td>50.000</td>
                  <td>
                    <span class="badge bg-success">
                      <i class="fas fa-check-circle me-1"></i> Lunas
                    </span>
                  </td>
                </tr>
                <tr>
                  <td>TRX-002</td>
                  <td>2025-05-11</td>
                  <td>Pembelian Obat Paracetamol</td>
                  <td>10.000</td>
                  <td>
                    <span class="badge bg-success">
                      <i class="fas fa-check-circle me-1"></i> Lunas
                    </span>
                  </td>
                </tr>
                <!-- Tambahkan baris lain sesuai kebutuhan -->
              </tbody>
            </table>
            <div class="mt-4">
              <h5>Statistik Pendapatan Bulanan</h5>
              <canvas id="chartPendapatan" height="150"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Section Manajemen User -->
      <section class="content" id="contentUser" style="display:none;">
        <div class="content-header">
          <h1>Manajemen User</h1>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Daftar User Petugas Kasir</h3>
          </div>
          <div class="card-body">
            <button id="btnTambahUser" class="btn btn-primary mb-3">Tambah User</button>
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>ID User</th>
                  <th>Nama</th>
                  <th>Username</th>
                  <th>Role</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>USR-001</td>
                  <td>Andi Wijaya</td>
                  <td>andiw</td>
                  <td>Kasir</td>
                  <td>
                    <button class="btn btn-sm btn-warning btn-edit-user">Edit</button>
                    <button class="btn btn-sm btn-danger">Hapus</button>
                  </td>
                </tr>
                <!-- Tambahkan data user lain sesuai kebutuhan -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Modal Tambah Layanan -->
      <div class="modal fade" id="modalTambahLayanan" tabindex="-1">
        <div class="modal-dialog">
          <form id="formTambahLayanan" class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Tambah Layanan Baru</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="namaLayanan" class="form-label">Nama Layanan</label>
                <input type="text" class="form-control" id="namaLayanan" required>
              </div>
              <div class="mb-3">
                <label for="hargaLayanan" class="form-label">Harga</label>
                <input type="number" class="form-control" id="hargaLayanan" required min="0" step="1000">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
              <button type="submit" class="btn btn-primary">Simpan</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal Edit Layanan -->
      <div class="modal fade" id="modalEditLayanan" tabindex="-1">
        <div class="modal-dialog">
          <form id="formEditLayanan" class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Edit Layanan</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="editIdLayanan" class="form-label">ID Layanan</label>
                <input type="text" class="form-control" id="editIdLayanan" readonly>
              </div>
              <div class="mb-3">
                <label for="editNamaLayanan" class="form-label">Nama Layanan</label>
                <input type="text" class="form-control" id="editNamaLayanan" required>
              </div>
              <div class="mb-3">
                <label for="editHargaLayanan" class="form-label">Harga</label>
                <input type="number" class="form-control" id="editHargaLayanan" required min="0" step="1000">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
              <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal Tambah User -->
      <div class="modal fade" id="modalTambahUser" tabindex="-1" aria-labelledby="modalTambahUserLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <form id="formTambahUser" class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalTambahUserLabel">Tambah User Baru</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="namaUser" class="form-label">Nama</label>
                <input type="text" class="form-control" id="namaUser" required>
              </div>
              <div class="mb-3">
                <label for="usernameUser" class="form-label">Username</label>
                <input type="text" class="form-control" id="usernameUser" required>
              </div>
              <div class="mb-3">
                <label for="passwordUser" class="form-label">Password</label>
                <input type="password" class="form-control" id="passwordUser" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
              <button type="submit" class="btn btn-primary">Simpan</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal Edit User -->
      <div class="modal fade" id="modalEditUser" tabindex="-1" aria-labelledby="modalEditUserLabel" aria-hidden="true">
        <div class="modal-dialog">
          <form id="formEditUser" class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalEditUserLabel">Edit User</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="editIdUser" class="form-label">ID User</label>
                <input type="text" class="form-control" id="editIdUser" readonly>
              </div>
              <div class="mb-3">
                <label for="editNamaUser" class="form-label">Nama</label>
                <input type="text" class="form-control" id="editNamaUser" required>
              </div>
              <div class="mb-3">
                <label for="editUsernameUser" class="form-label">Username</label>
                <input type="text" class="form-control" id="editUsernameUser" required>
              </div>
              <div class="mb-3">
                <label for="editPasswordUser" class="form-label">Password</label>
                <input type="password" class="form-control" id="editPasswordUser" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
              <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
            </div>
          </form>
        </div>
      </div>

    </div> <!-- end content-wrapper -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2.0/dist/js/adminlte.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Library untuk export Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <!-- Library untuk export PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
      $(document).ready(function () {
        $('#btnTambahLayanan').on('click', function () {
          $('#formTambahLayanan')[0].reset();
          $('#modalTambahLayanan').modal('show');
        });

        $('.btn-edit-layanan').on('click', function () {
          const row = $(this).closest('tr');
          const id = row.find('td:eq(0)').text().trim();
          const nama = row.find('td:eq(1)').text().trim();
          const harga = row.find('td:eq(2)').text().replace(/[^\d]/g, '');

          $('#editIdLayanan').val(id);
          $('#editNamaLayanan').val(nama);
          $('#editHargaLayanan').val(harga);
          $('#modalEditLayanan').modal('show');
        });

        // Navigasi menu
        $('#menu-jasa').on('click', function () {
          $('#contentJasa').show();
          $('#contentHargaObat, #contentLaporan, #contentUser').hide();
          $('.nav-link').removeClass('active');
          $(this).addClass('active');
        });

        $('#menu-obat').on('click', function () {
          $('#contentHargaObat').show();
          $('#contentJasa, #contentLaporan, #contentUser').hide();
          $('.nav-link').removeClass('active');
          $(this).addClass('active');
        });

        $('#menu-laporan').on('click', function () {
          $('#contentLaporan').show();
          $('#contentJasa, #contentHargaObat, #contentUser').hide();
          $('.nav-link').removeClass('active');
          $(this).addClass('active');
        });

        $('#menu-user').on('click', function () {
          // Sembunyikan semua section konten
          $('#contentJasa, #contentHargaObat, #contentLaporan').hide();
          // Tampilkan section Manajemen User
          $('#contentUser').show();

          // Atur kelas active pada menu sidebar
          $('.nav-link').removeClass('active');
          $(this).addClass('active');
        });

        // Simulasi submit form
        $('#formTambahLayanan, #formEditLayanan').on('submit', function (e) {
          e.preventDefault();
          alert('Data layanan disimpan (simulasi).');
          $('.modal').modal('hide');
        });
      });

      $(document).ready(function () {
        // Tampilkan modal Tambah User saat tombol diklik
        $('#btnTambahUser').on('click', function () {
          $('#formTambahUser')[0].reset();
          $('#modalTambahUser').modal('show');
        });

        // Tampilkan modal Edit User saat tombol edit diklik
        $('.btn-edit-user').on('click', function () {
          const row = $(this).closest('tr');
          const id = row.find('td:eq(0)').text().trim();
          const nama = row.find('td:eq(1)').text().trim();
          const username = row.find('td:eq(2)').text().trim();
          // Password biasanya tidak ditampilkan, bisa dikosongkan atau diisi placeholder
          $('#editIdUser').val(id);
          $('#editNamaUser').val(nama);
          $('#editUsernameUser').val(username);
          $('#editPasswordUser').val(''); // kosongkan password agar user isi ulang jika ingin ganti
          $('#modalEditUser').modal('show');
        });

        // Simulasi submit form Tambah User
        $('#formTambahUser').on('submit', function (e) {
          e.preventDefault();
          // Ambil data dari form
          const nama = $('#namaUser').val();
          const username = $('#usernameUser').val();
          const password = $('#passwordUser').val();
          // TODO: Tambahkan validasi dan simpan data ke backend atau array
          alert(`User baru ditambahkan:\nNama: ${nama}\nUsername: ${username}`);
          $('#modalTambahUser').modal('hide');
        });

        // Simulasi submit form Edit User
        $('#formEditUser').on('submit', function (e) {
          e.preventDefault();
          const id = $('#editIdUser').val();
          const nama = $('#editNamaUser').val();
          const username = $('#editUsernameUser').val();
          const password = $('#editPasswordUser').val();
          // TODO: Tambahkan validasi dan update data ke backend atau array
          alert(`User dengan ID ${id} diperbarui:\nNama: ${nama}\nUsername: ${username}`);
          $('#modalEditUser').modal('hide');
        });
      });
      $(document).ready(function () {
        // Data contoh pendapatan bulanan (bisa diganti dengan data dinamis)
        const dataPendapatan = {
          "2025-01": 450000,
          "2025-02": 520000,
          "2025-03": 610000,
          "2025-04": 480000,
          "2025-05": 600000,
          // Tambahkan data bulan lain sesuai kebutuhan
        };

        // Fungsi untuk format bulan ke nama bulan (Indonesia)
        function formatBulan(bulanStr) {
          const bulanMap = {
            "01": "Jan",
            "02": "Feb",
            "03": "Mar",
            "04": "Apr",
            "05": "Mei",
            "06": "Jun",
            "07": "Jul",
            "08": "Agu",
            "09": "Sep",
            "10": "Okt",
            "11": "Nov",
            "12": "Des"
          };
          const parts = bulanStr.split("-");
          return bulanMap[parts[1]] + " " + parts[0];
        }

        // Siapkan data untuk chart
        const labels = Object.keys(dataPendapatan).map(formatBulan);
        const values = Object.values(dataPendapatan);

        // Inisialisasi Chart.js
        const ctx = document.getElementById('chartPendapatan').getContext('2d');
        const chartPendapatan = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Pendapatan (Rp)',
              data: values,
              borderColor: 'rgba(54, 162, 235, 1)',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              fill: true,
              tension: 0.3,
              pointRadius: 5,
              pointHoverRadius: 7,
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  // Format angka dengan ribuan
                  callback: function (value) {
                    return 'Rp ' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                  }
                }
              }
            },
            plugins: {
              legend: {
                display: true,
                position: 'top',
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return 'Rp ' + context.parsed.y.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                  }
                }
              }
            }
          }
        });

        // Fungsi filter data tabel berdasarkan bulan yang dipilih
        $('#filterBulan').on('change', function () {
          const bulanTerpilih = $(this).val(); // format yyyy-mm
          if (!bulanTerpilih) {
            // Jika kosong, tampilkan semua baris
            $('#contentLaporan table tbody tr').show();
            return;
          }

          // Filter baris tabel berdasarkan kolom tanggal (kolom ke-2)
          $('#contentLaporan table tbody tr').each(function () {
            const tanggal = $(this).find('td:eq(1)').text().trim(); // format yyyy-mm-dd
            if (tanggal.startsWith(bulanTerpilih)) {
              $(this).show();
            } else {
              $(this).hide();
            }
          });
        });
      });
      $(document).ready(function () {
        // Fungsi export tabel ke Excel
        $('#btnExportExcel').on('click', function () {
          // Ambil tabel
          const table = document.querySelector('#contentLaporan table');
          // Konversi tabel ke worksheet
          const wb = XLSX.utils.book_new();
          const ws = XLSX.utils.table_to_sheet(table);
          XLSX.utils.book_append_sheet(wb, ws, "Laporan");
          // Simpan file Excel
          XLSX.writeFile(wb, "laporan_keuangan.xlsx");
        });

        // Fungsi export tabel ke PDF
        $('#btnExportPDF').on('click', function () {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          doc.text("Laporan Keuangan - Detail Transaksi", 14, 15);

          // Ambil data tabel
          doc.autoTable({
            html: '#contentLaporan table',
            startY: 25,
            styles: { fontSize: 8 },
            headStyles: { fillColor: [54, 162, 235] },
            theme: 'striped',
          });

          doc.save('laporan_keuangan.pdf');
        });
      });
    </script>
  </div>
</body>

</html>